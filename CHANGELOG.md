# Changelog

Все значимые изменения в проекте MetricsOOP документируются в этом файле.

## [1.2.1] - 2026-02-05

### Исправлено
- Ошибка "An item with the same key has already been added" при анализе проектов с частичными классами (partial classes), например WinForms
- Теперь частичные классы корректно объединяются в одну сущность перед расчётом метрик

## [1.2.0] - 2026-02-05

### Добавлено
- **NOM** (Number of Methods) — учёт методов, конструкторов, аксессоров свойств/индексаторов и событий
- **MPC** (Message Passing Coupling) — количество внешних вызовов методов на класс
- Метрики пакетов: **NCP**, **OutC**, **InC**, **HC**, **SPC**, **SCC**
- `COMPLIANCE_REPORT.md` — отчёт соответствия PDF-спецификации и SonarQube snippet анализа
- Тесты метрик (DIT, NOM, CBO, MPC, Cognitive Complexity, package metrics)

### Изменено
- **DIT**: корень дерева наследования фиксирован как `System.Object`
- **CBO**: исключено двойное считывание взаимной связанности, сохранены варианты total/no-inheritance
- **Cognitive Complexity**: учёт последовательностей `&&/||`, `switch`, `catch`, `goto`
- Отчёт и README: обновлены формулы и вывод новых метрик

## [1.1.0] - 2026-02-05

### Добавлено

#### Метрики связности класса
- **TCC** (Tight Class Cohesion) — плотная связность класса (0-1)
- **LCC** (Loose Class Cohesion) — слабая связность класса с учётом косвенных связей

#### Когнитивная сложность
- **Cognitive Complexity** — алгоритм SonarSource с учётом вложенности
- Штрафы за вложенные структуры управления
- Детектирование рекурсии

#### Метрики пакетов (Robert C. Martin)
- **Ca** (Afferent Coupling) — входящие зависимости пакета
- **Ce** (Efferent Coupling) — исходящие зависимости пакета
- **I** (Instability) — нестабильность пакета
- **A** (Abstractness) — абстрактность пакета
- **D** (Distance from Main Sequence) — расстояние от главной последовательности

#### Разделение CBO
- **CBO Total** — связанность с учётом наследования
- **CBO No Inheritance** — связанность без учёта базовых классов и интерфейсов

#### Новые модели
- `PackageMetrics.cs` — модель метрик пакетов
- `PackageMetricsCalculator.cs` — вычислитель метрик пакетов

### Изменено
- Расширен отчёт: секции TCC/LCC, Cognitive Complexity, Package Metrics
- Обновлена таблица метрик в консольном выводе
- JSON-экспорт включает все новые метрики

---

## [1.0.0] - 2026-02-05

### Добавлено

#### Метрики CK (Chidamber & Kemerer)
- **WMC** (Weighted Methods per Class) — взвешенные методы класса (сумма цикломатических сложностей)
- **DIT** (Depth of Inheritance Tree) — глубина дерева наследования
- **NOC** (Number of Children) — количество прямых наследников
- **CBO** (Coupling Between Objects) — связанность между объектами
- **RFC** (Response for a Class) — отклик класса (методы + вызываемые методы)
- **LCOM** (Lack of Cohesion of Methods) — недостаток связности методов (LCOM4)

#### Метрики MOOD (Metrics for Object-Oriented Design)
- **MHF** (Method Hiding Factor) — фактор сокрытия методов
- **AHF** (Attribute Hiding Factor) — фактор сокрытия атрибутов
- **MIF** (Method Inheritance Factor) — фактор наследования методов
- **AIF** (Attribute Inheritance Factor) — фактор наследования атрибутов
- **PF** (Polymorphism Factor) — фактор полиморфизма
- **CF** (Coupling Factor) — фактор связанности

#### Метрики размера
- **LOC** (Lines of Code) — общее количество строк кода
- **SLOC** (Source Lines of Code) — строки исходного кода (без комментариев и пустых)
- Количество классов, интерфейсов, методов, полей, свойств
- Количество строк комментариев

#### Метрики сложности
- **Цикломатическая сложность McCabe** — количество линейно независимых путей
- **Метрики Холстеда**:
  - Словарь программы (η)
  - Длина программы (N)
  - Объём (V)
  - Сложность (D)
  - Усилие (E)
  - Время программирования (T)
  - Оценка ошибок (B)
- **Maintainability Index** — индекс сопровождаемости (0-100)

#### Парсер кода
- Анализ C# кода с использованием Microsoft.CodeAnalysis (Roslyn)
- Извлечение классов, интерфейсов, методов, полей, свойств
- Построение графа наследования
- Определение связанности между классами
- Подсчёт цикломатической сложности по decision points

#### Генератор отчётов
- Цветной консольный вывод с индикацией проблемных метрик
- Таблица метрик по классам
- Список классов, требующих внимания
- Экспорт в JSON формат

#### CLI интерфейс
- Анализ одного файла или директории
- Рекурсивный поиск `.cs` файлов
- Флаг `-v/--verbose` для детального вывода
- Флаг `-o/--output` для экспорта в JSON
- Справка `--help`

### Пороговые значения

| Метрика | Предупреждение | Критично |
|---------|----------------|----------|
| WMC | > 20 | > 50 |
| DIT | > 4 | > 6 |
| NOC | > 10 | > 20 |
| CBO | > 8 | > 14 |
| RFC | > 50 | > 100 |
| LCOM | > 2 | > 4 |
| CC | > 10 | > 20 |
| MI | < 60 | < 40 |
| CF | > 0.12 | > 0.2 |

### Технологии
- .NET 10.0
- Microsoft.CodeAnalysis.CSharp 4.12.0
- Newtonsoft.Json 13.0.4
